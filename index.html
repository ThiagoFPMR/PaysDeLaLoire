<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Pays de la Loire Mask Example</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
<style>
  body { margin: 0; padding: 0; }
  #map { position: absolute; top: 0; bottom: 0; width: 100%; background: #dcdcdc; }
</style>
</head>
<body>
<div id="map"></div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoidGhpYWdvZnBtciIsImEiOiJjbWhwcWwxNGcwbzJvMnJwejZuZmRieHJrIn0.RKTRD-IiM8qToIwirPZacw';

const map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/outdoors-v12',
  center: [-0.8, 47.5], // roughly center of Pays de la Loire
  zoom: 6
});

map.on('load', async () => {
  // Fetch the GeoJSON for French regions
  const response = await fetch('https://france-geojson.gregoiredavid.fr/repo/regions.geojson');
  const franceRegions = await response.json();

  // Find Pays de la Loire
  const paysDeLaLoire = franceRegions.features.find(
    f => f.properties.nom === "Pays de la Loire"
  );

  // Create a world polygon
  const world = {
    type: "Polygon",
    coordinates: [
      [
        [-180, -90],
        [180, -90],
        [180, 90],
        [-180, 90],
        [-180, -90]
      ]
    ]
  };

  // Invert the mask (world minus region)
  const mask = turf.difference(world, paysDeLaLoire);

  // Add the visible region source/layer
  map.addSource('region', { type: 'geojson', data: paysDeLaLoire });
  map.addLayer({
    id: 'region-fill',
    type: 'fill',
    source: 'region',
    paint: {
      'fill-color': '#FFFFFF',
      'fill-opacity': 0.1
    }
  });

  // Add the mask layer on top to hide everything outside
  map.addSource('mask', { type: 'geojson', data: mask });
  map.addLayer({
    id: 'mask-layer',
    type: 'fill',
    source: 'mask',
    paint: {
      'fill-color': '#dcdcdc',  // background outside
      'fill-opacity': 1
    }
  });

  // Optional: disable infinite map wrapping
  map.setRenderWorldCopies(false);

  // Optional: restrict panning/zooming to region bounds
  const bounds = turf.bbox(paysDeLaLoire);
  const expandedBounds = [
    bounds[0] - 6,  // west
    bounds[1] - 6,  // south
    bounds[2] + 6,  // east
    bounds[3] + 6   // north
  ];
  map.setMaxBounds(expandedBounds);
});
</script>
</body>
</html>
